<!doctype html>
<html lang="en">
  <head>
    <link
      rel="stylesheet"
      href="https://unpkg.com/tabulator-tables@5/dist/css/tabulator.min.css"
    />
    <script src="https://unpkg.com/tabulator-tables@5/dist/js/tabulator.min.js"></script>
    <meta charset="UTF-8" />
    <title>MPT MVP</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="performance-optimizations.css" />
  </head>
  <body>
    <nav>
      <div class="nav-links">
        <a href="#planning">Planning</a>
        <span class="nav-separator">|</span>
        <a href="#execution">Execution</a>
        <span class="nav-separator">|</span>
        <a href="#budgets">Budgets</a>
        <span class="nav-separator">|</span>
        <a href="#calendar">Calendar</a>
        <span class="nav-separator">|</span>
        <a href="#roi">ROI</a>
        <span class="nav-separator">|</span>
        <a href="#github-sync">GitHub Sync</a>
      </div>
      <a
        href="https://github.com/"
        target="_blank"
        aria-label="GitHub"
        class="github-link"
        style="padding: 0; margin: 0"
      >
        <svg class="github-logo" viewBox="0 0 24 24" aria-hidden="true">
          <path
            d="M12 2C6.48 2 2 6.58 2 12.26c0 4.48 2.87 8.28 6.84 9.63.5.09.68-.22.68-.48 0-.24-.01-.87-.01-1.7-2.78.62-3.37-1.36-3.37-1.36-.45-1.18-1.1-1.5-1.1-1.5-.9-.63.07-.62.07-.62 1 .07 1.53 1.05 1.53 1.05.89 1.56 2.34 1.11 2.91.85.09-.66.35-1.11.63-1.37-2.22-.26-4.56-1.14-4.56-5.07 0-1.12.39-2.03 1.03-2.75-.1-.26-.45-1.3.1-2.7 0 0 .84-.28 2.75 1.05A9.38 9.38 0 0 1 12 6.84c.85.004 1.71.12 2.51.34 1.91-1.33 2.75-1.05 2.75-1.05.55 1.4.2 2.44.1 2.7.64.72 1.03 1.63 1.03 2.75 0 3.94-2.34 4.81-4.57 5.07.36.32.68.94.68 1.9 0 1.37-.01 2.47-.01 2.81 0 .27.18.58.69.48A10.01 10.01 0 0 0 22 12.26C22 6.58 17.52 2 12 2z"
          />
        </svg>
      </a>
    </nav>

    <section id="view-planning" style="display: none">
      <!-- Planning Filters Section -->
      <div id="planningFilters" class="filter-container">
        <!-- Row 1: Search and Core Filters -->
        <div class="filter-row filter-row-main">
          <div class="filter-group">
            <label for="planningRegionFilter">Region:</label>
            <select id="planningRegionFilter" class="filter-select" multiple>
              <!-- Options populated dynamically -->
            </select>
          </div>
          <div class="filter-group">
            <label for="planningQuarterFilter">Quarter:</label>
            <select id="planningQuarterFilter" class="filter-select" multiple>
              <!-- Options populated dynamically -->
            </select>
          </div>
          <div class="filter-group">
            <label for="planningStatusFilter">Status:</label>
            <select id="planningStatusFilter" class="filter-select" multiple>
              <!-- Options populated dynamically -->
            </select>
          </div>
        </div>
        
        <!-- Row 2: Secondary Filters -->
        <div class="filter-row filter-row-secondary">
          <div class="filter-group">
            <label for="planningProgramTypeFilter">Program Type:</label>
            <select id="planningProgramTypeFilter" class="filter-select" multiple>
              <!-- Options populated dynamically -->
            </select>
          </div>
          <div class="filter-group">
            <label for="planningStrategicPillarFilter">Strategic Pillar:</label>
            <select id="planningStrategicPillarFilter" class="filter-select" multiple>
              <!-- Options populated dynamically -->
            </select>
          </div>
          <div class="filter-group">
            <label for="planningOwnerFilter">Owner:</label>
            <select id="planningOwnerFilter" class="filter-select" multiple>
              <!-- Options populated dynamically -->
            </select>
          </div>
          
          <!-- Action Buttons -->
          <div class="filter-actions">
            <button id="planningDigitalMotionsFilter" class="filter-btn filter-btn-digital">
              üöÄ Digital Motions
            </button>
            <button id="planningClearFilters" class="filter-btn filter-btn-clear">
              Clear Filters
            </button>
          </div>
        </div>
      </div>

      <div
        id="planningGridButtons"
        style="
          display: flex;
          gap: 12px;
          margin-bottom: 18px;
          align-items: center;
          justify-content: space-between;
        "
      >
        <div style="display: flex; gap: 12px; align-items: center">
          <button id="addPlanningRow">‚ûï Add Campaign</button>
          <button id="deletePlanningRow">Delete Row</button>
          <button id="importCSVBtn">Import Campaign</button>
          <input
            type="file"
            id="csvFileInput"
            accept=".csv"
            style="display: none"
          />
        </div>
        <button id="savePlanningRows" class="save-large">Save Changes</button>
      </div>
      <div id="planningGrid"></div>
    </section>
    <section id="view-execution" style="display: none">
      <!-- Execution Filters -->
      <div id="executionFilters" class="filter-container">
        <!-- Row 1: Search and Core Filters -->
        <div class="filter-row filter-row-main">
          <div class="filter-group">
            <label for="executionRegionFilter">Region:</label>
            <select id="executionRegionFilter" class="filter-select">
              <option value="">(All Regions)</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="executionQuarterFilter">Quarter:</label>
            <select id="executionQuarterFilter" class="filter-select">
              <option value="">(All Quarters)</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="executionStatusFilter">Status:</label>
            <select id="executionStatusFilter" class="filter-select">
              <option value="">(All Statuses)</option>
            </select>
          </div>
        </div>
        
        <!-- Row 2: Secondary Filters -->
        <div class="filter-row filter-row-secondary">
          <div class="filter-group">
            <label for="executionProgramTypeFilter">Program Type:</label>
            <select id="executionProgramTypeFilter" class="filter-select">
              <option value="">(All Program Types)</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="executionStrategicPillarFilter">Strategic Pillar:</label>
            <select id="executionStrategicPillarFilter" class="filter-select">
              <option value="">(All Strategic Pillars)</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="executionOwnerFilter">Owner:</label>
            <select id="executionOwnerFilter" class="filter-select">
              <option value="">(All Owners)</option>
            </select>
          </div>
          
          <!-- Action Buttons -->
          <div class="filter-actions">
            <button id="executionDigitalMotionsFilter" class="filter-btn filter-btn-digital">
              üöÄ Digital Motions
            </button>
            <button id="executionClearFilters" class="filter-btn filter-btn-clear">
              Clear Filters
            </button>
          </div>
        </div>
      </div>
      
      <div id="executionGrid"></div>
    </section>
    <section id="view-budgets" style="display: none">
      <!-- Main Budget Overview Chart -->
      <div
        style="
          background: #fff;
          border-radius: 12px;
          box-shadow: 0 2px 12px rgba(25, 118, 210, 0.08);
          padding: 20px;
          margin-bottom: 24px;
          max-width: 1200px;
        "
      >
        <h3 style="margin: 0 0 16px 0; color: #1976d2">
          Budget Overview by Region
        </h3>
        <canvas id="budgetsBarChart" style="max-height: 300px"></canvas>
      </div>

      <div
        style="
          display: flex;
          align-items: flex-start;
          gap: 12px;
          margin-bottom: 8px;
        "
      >
        <div
          id="budgetsChartsContainer"
          style="
            display: flex;
            flex-wrap: wrap;
            gap: 32px 24px;
            margin-bottom: 24px;
          "
        ></div>
      </div>
      <div id="budgetsTable"></div>
    </section>
    <section id="view-calendar" style="display: none">
      <!-- Financial Year Tabs -->
      <div style="margin-bottom: 20px">
        <h3 style="margin-bottom: 10px">Financial Year:</h3>
        <div id="fyTabs" style="display: flex; gap: 8px; flex-wrap: wrap">
          <!-- FY tabs will be populated by JavaScript -->
        </div>
      </div>

      <!-- Filter Controls -->
      <div id="calendarFilters">
        <!-- Filter controls will be populated by JavaScript -->
      </div>

      <!-- Calendar Container -->
      <div
        id="calendarContainer"
        style="background: #f5f5f5; border-radius: 8px; padding: 16px"
      >
        <div id="calendarGrid">
          <!-- Calendar grid will be populated by JavaScript -->
        </div>
      </div>

      <!-- Instructions -->
      <div
        style="
          margin-top: 20px;
          padding: 16px;
          background: #e3f2fd;
          border-radius: 6px;
          color: #1976d2;
        "
      >
        <h4 style="margin-top: 0">üìÖ Campaign Calendar View</h4>
        <p style="margin-bottom: 0">
          This calendar displays all campaigns from your planning data organized
          by month. Switch between financial years using the tabs above, use
          filters to narrow down campaigns, and click on any campaign to view
          detailed information.
        </p>
      </div>
    </section>
    <section id="view-github-sync" style="display: none">
      <div id="githubSync">
        <div id="githubSyncLocked" style="text-align: center; padding: 40px;">
          <h3>üîí GitHub Sync Access Restricted</h3>
          <p>This section requires administrator permissions.</p>
          <p>Please click the "GitHub Sync" tab to authenticate.</p>
        </div>
        <div id="githubSyncUnlocked" style="display: none;">
          <h3>‚úÖ GitHub Sync Unlocked</h3>
          <p>GitHub synchronization features are now available.</p>
          <div style="background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0;">
            <h4>Available Actions:</h4>
            <ul>
              <li>Sync planning data to GitHub</li>
              <li>Export execution data</li>
              <li>Download ROI reports</li>
              <li>Backup budget configurations</li>
            </ul>
          </div>
          <div style="margin: 20px 0;">
            <button onclick="syncToGithub()" style="background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 6px; margin-right: 10px; cursor: pointer;">
              üîÑ Sync to GitHub
            </button>
            <button onclick="exportData()" style="background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 6px; margin-right: 10px; cursor: pointer;">
              üìÅ Export Data
            </button>
            <button onclick="downloadReports()" style="background: #6f42c1; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer;">
              üìä Download Reports
            </button>
          </div>
        </div>
      </div>
      <!-- Password Modal for GitHub Sync -->
      <div id="githubSyncPasswordModal" class="password-modal">
        <div class="password-modal-content">
          <h3>üîí Unlock GitHub Sync</h3>
          <p>Enter password to access GitHub synchronization features</p>
          <input
            id="githubSyncPasswordInput"
            type="password"
            class="password-modal-input"
            placeholder="Enter password..."
          />
          <div class="password-modal-error" id="githubSyncPasswordError"></div>
          <div class="password-modal-buttons">
            <button id="githubSyncPasswordSubmit" class="password-modal-button primary">
              Unlock Access
            </button>
            <button id="githubSyncPasswordCancel" class="password-modal-button secondary">
              Cancel
            </button>
          </div>
        </div>
      </div>
    </section>
    <section id="view-budget-setup" style="display: none">
      <div id="annualBudgetContainer">
        <table id="planTable" border="1" cellpadding="6">
          <thead>
            <tr>
              <th>Region</th>
              <th>Plan (USD)</th>
              <th></th>
              <!-- Delete column header -->
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><input type="text" value="ANZ" disabled /></td>
              <td><input type="number" value="500000" disabled /></td>
            </tr>
            <tr>
              <td><input type="text" value="SAARC" disabled /></td>
              <td><input type="number" value="300000" disabled /></td>
            </tr>
          </tbody>
        </table>
        <div id="annualBudgetButtons">
          <button id="addRegionRow" disabled>+ Add Region</button>
          <button id="saveAnnualBudget" disabled>Save Annual Budget</button>
        </div>
      </div>
      <!-- Password Modal for Annual Budget Edit -->
      <div id="annualBudgetPasswordModal" class="password-modal">
        <div class="password-modal-content">
          <h3>üí∞ Unlock Annual Budget</h3>
          <p>Enter password to edit the annual budget plan</p>
          <input
            id="annualBudgetPasswordInput"
            type="password"
            class="password-modal-input"
            placeholder="Enter password..."
          />
          <div class="password-modal-error" id="annualBudgetPasswordError"></div>
          <div class="password-modal-buttons">
            <button id="annualBudgetPasswordSubmit" class="password-modal-button primary">
              Unlock Editing
            </button>
            <button id="annualBudgetPasswordCancel" class="password-modal-button secondary">
              Cancel
            </button>
          </div>
        </div>
      </div>
    </section>
    <section id="view-roi" style="display: none">
      <div id="roiFiltersDiv" class="filters-container">
        <div class="filter-group">
          <label for="roiRegionFilter">Filter by Region:</label>
          <select id="roiRegionFilter">
            <option value="">(All Regions)</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="roiQuarterFilter">Filter by Quarter:</label>
          <select id="roiQuarterFilter">
            <option value="">(All Quarters)</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="roiCountryFilter">Country:</label>
          <select id="roiCountryFilter">
            <option value="">(All Countries)</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="roiOwnerFilter">Owner:</label>
          <select id="roiOwnerFilter">
            <option value="">(All Owners)</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="roiStatusFilter">Status:</label>
          <select id="roiStatusFilter">
            <option value="">(All Statuses)</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="roiProgramTypeFilter">Program Type:</label>
          <select id="roiProgramTypeFilter">
            <option value="">(All Program Types)</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="roiStrategicPillarsFilter">Strategic Pillars:</label>
          <select id="roiStrategicPillarsFilter">
            <option value="">(All Pillars)</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="roiRevenuePlayFilter">Revenue Play:</label>
          <select id="roiRevenuePlayFilter">
            <option value="">(All Revenue Plays)</option>
          </select>
        </div>
        <button id="roiClearFilters" class="clear-filters-btn">
          Clear Filters
        </button>
      </div>
      <div class="roi-performance-container">
        <!-- Top Section: ROI Gauge and Main Metrics -->
        <div class="roi-top-section">
          <!-- ROI Gauge Chart -->
          <div class="roi-gauge-container">
            <h4 class="roi-gauge-title">üéØ ROI Performance</h4>
            <div class="roi-gauge-chart-wrapper">
              <canvas id="roiGaugeChart"></canvas>
            </div>
          </div>

          <!-- Main ROI Metrics Grid -->
          <div class="roi-metrics-grid">
            <div class="roi-info-box costs">
              <div class="roi-info-box-label">Total Costs</div>
              <div id="roiTotalSpendValue" class="roi-info-box-value">$0</div>
            </div>

            <div class="roi-info-box pipeline">
              <div class="roi-info-box-label">Total Forecasted Pipeline</div>
              <div id="roiTotalPipelineValue" class="roi-info-box-value">$0</div>
            </div>

            <div class="roi-info-box leads">
              <div class="roi-info-box-label">Total Leads/Conversions</div>
              <div id="roiTotalLeadsValue" class="roi-info-box-value">0</div>
            </div>

            <div class="roi-info-box mql">
              <div class="roi-info-box-label">Total MQL</div>
              <div id="roiTotalMqlValue" class="roi-info-box-value">0</div>
            </div>
          </div>
        </div>

        <!-- Bottom Metrics Row -->
        <div class="roi-metrics-bottom">
          <div class="roi-info-box forecasted">
            <div class="roi-info-box-label">Total Forecasted Cost</div>
            <div id="roiTotalForecastedCostValue" class="roi-info-box-value">$0</div>
          </div>

          <div class="roi-info-box remaining">
            <div class="roi-info-box-label">Remaining Budget</div>
            <div id="roiRemainingBudgetValue" class="roi-info-box-value">$0</div>
          </div>

          <div class="roi-info-box usage">
            <div class="roi-info-box-label">Forecasted Budget Usage</div>
            <div id="roiForecastedBudgetValue" class="roi-info-box-value">$0</div>
          </div>
        </div>
      </div>

        <div id="roiChartTabsContainer" class="chart-tabs-container">
          <!-- Tab Navigation -->
          <div id="roiChartTabs" class="chart-tabs-nav">
            <button id="roiRegionTabBtn" class="roi-chart-tab active">
              ROI by Region
            </button>
            <button id="roiProgramTypeTabBtn" class="roi-chart-tab">
              Data Table
            </button>
            <button id="roiQuarterTabBtn" class="roi-chart-tab">
              Forecasted vs Actual
            </button>
          </div>

          <!-- Chart Content Area -->
          <div id="roiChartContent" class="chart-content-area">
            <!-- ROI by Region Chart -->
            <div id="roiRegionChartContainer" class="roi-chart-panel active">
              <h3 class="chart-panel-title">ROI Performance by Region</h3>
              <div class="chart-wrapper">
                <canvas id="roiRegionChart"></canvas>
              </div>
            </div>

            <!-- Data Table -->
            <div id="roiProgramTypeChartContainer" class="roi-chart-panel">
              <h3 class="chart-panel-title">Campaign Data Table</h3>
              <div class="table-wrapper">
                <div id="roiDataTable"></div>
              </div>
            </div>

            <!-- Forecasted vs Actual Chart -->
            <div id="roiQuarterChartContainer" class="roi-chart-panel">
              <h3 class="chart-panel-title">Forecasted vs Actual Performance</h3>
              <div class="chart-wrapper">
                <canvas id="roiQuarterChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="roiContent">
        <!-- ROI content will go here -->
      </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="charts.js"></script>
    <script type="module" src="src/cloudflare-sync.js"></script>
    <script type="module" src="planning.js"></script>
    <script type="module" src="execution.js"></script>
    <script type="module" src="budgets.js"></script>
    <script type="module" src="roi.js"></script>
    <script type="module" src="calendar.js"></script>
    <script type="module" src="app.js"></script>
  </body>
</html>
