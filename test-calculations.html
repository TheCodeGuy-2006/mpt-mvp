<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculation Validation Test</title>
</head>
<body>
    <h1>Campaign Calculation Validation</h1>
    
    <div>
        <h2>Test Calculations</h2>
        
        <div id="test-results"></div>
        
        <h3>Manual Test</h3>
        <div>
            <label>Program Type: 
                <select id="programType">
                    <option value="Regular">Regular Program</option>
                    <option value="In-Account Events (1:1)">In-Account Events (1:1)</option>
                </select>
            </label>
        </div>
        <div>
            <label>Expected Leads: <input type="number" id="expectedLeads" value="1000"></label>
        </div>
        <div>
            <label>Forecasted Cost: <input type="number" id="forecastedCost" value="10000"></label>
        </div>
        <button onclick="calculateTest()">Calculate</button>
        
        <div id="manual-results"></div>
    </div>
    
    <script type="module">
        // Import the calculation functions
        import { calculatePipeline } from './src/calc.js';
        
        // Make functions available globally for testing
        window.calculatePipeline = calculatePipeline;
        
        // Test the calculation logic
        function runTests() {
            const testResults = document.getElementById('test-results');
            let html = '<h4>Automated Tests:</h4>';
            
            // Test 1: Regular program with 1000 leads
            const leads1 = 1000;
            const expectedMql1 = Math.round(leads1 * 0.1); // 100
            const expectedPipeline1 = calculatePipeline(leads1); // 1000 * 2400 = 2,400,000
            
            html += `<div><strong>Test 1 - Regular program (${leads1} leads):</strong></div>`;
            html += `<div>MQL: ${expectedMql1} (should be 100)</div>`;
            html += `<div>Pipeline: $${expectedPipeline1.toLocaleString()} (should be $2,400,000)</div>`;
            html += `<div>✅ ${expectedMql1 === 100 && expectedPipeline1 === 2400000 ? 'PASS' : 'FAIL'}</div><br>`;
            
            // Test 2: In-Account Events with $10,000 cost
            const cost2 = 10000;
            const expectedLeads2 = 0;
            const expectedMql2 = 0;
            const expectedPipeline2 = cost2 * 20; // 10,000 * 20 = 200,000
            
            html += `<div><strong>Test 2 - In-Account Events ($${cost2} cost):</strong></div>`;
            html += `<div>Leads: ${expectedLeads2} (should be 0)</div>`;
            html += `<div>MQL: ${expectedMql2} (should be 0)</div>`;
            html += `<div>Pipeline: $${expectedPipeline2.toLocaleString()} (should be $200,000)</div>`;
            html += `<div>✅ ${expectedLeads2 === 0 && expectedMql2 === 0 && expectedPipeline2 === 200000 ? 'PASS' : 'FAIL'}</div><br>`;
            
            // Test 3: Edge case - zero leads
            const leads3 = 0;
            const expectedMql3 = Math.round(leads3 * 0.1); // 0
            const expectedPipeline3 = calculatePipeline(leads3); // 0
            
            html += `<div><strong>Test 3 - Zero leads:</strong></div>`;
            html += `<div>MQL: ${expectedMql3} (should be 0)</div>`;
            html += `<div>Pipeline: $${expectedPipeline3.toLocaleString()} (should be $0)</div>`;
            html += `<div>✅ ${expectedMql3 === 0 && expectedPipeline3 === 0 ? 'PASS' : 'FAIL'}</div><br>`;
            
            // Test 4: Check the calculation formula
            html += `<div><strong>Calculation Formula Check:</strong></div>`;
            html += `<div>calculatePipeline formula: leads * 2400</div>`;
            html += `<div>Breakdown: leads * 0.06 * 0.8 * 50000 = leads * 2400</div>`;
            html += `<div>6% conversion to SQL, 80% of SQL to opportunities, $50K per opportunity</div>`;
            
            testResults.innerHTML = html;
        }
        
        // Manual calculation test
        window.calculateTest = function() {
            const programType = document.getElementById('programType').value;
            const leads = Number(document.getElementById('expectedLeads').value) || 0;
            const cost = Number(document.getElementById('forecastedCost').value) || 0;
            
            let resultLeads, resultMql, resultPipeline;
            
            if (programType === 'In-Account Events (1:1)') {
                resultLeads = 0;
                resultMql = 0;
                resultPipeline = cost * 20;
            } else {
                resultLeads = leads;
                resultMql = Math.round(leads * 0.1);
                resultPipeline = calculatePipeline(leads);
            }
            
            const resultsDiv = document.getElementById('manual-results');
            resultsDiv.innerHTML = `
                <h4>Results for ${programType}:</h4>
                <div>Expected Leads: ${resultLeads}</div>
                <div>MQL Forecast: ${resultMql}</div>
                <div>Pipeline Forecast: $${resultPipeline.toLocaleString()}</div>
                <div><em>These should match what you see in the planning grid</em></div>
            `;
        };
        
        // Run tests on page load
        runTests();
    </script>
</body>
</html>
